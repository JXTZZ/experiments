--- a/src/libponyc/ast/lexer.c
+++ b/src/libponyc/ast/lexer.c
@@ -526,23 +526,29 @@
 
   // Trim a leading newline if there is one.
   char* buf = lexer->buffer;
+  bool had_leading_newline = false;
 
   if((buf[0] == '\r') && (buf[1] == '\n'))
   {
     lexer->buflen -= 2;
     memmove(&buf[0], &buf[2], lexer->buflen);
+    had_leading_newline = true;
   }
   else if(buf[0] == '\n')
   {
     lexer->buflen--;
     memmove(&buf[0], &buf[1], lexer->buflen);
+    had_leading_newline = true;
   }
 
   // Calculate leading whitespace.
+  // Only consider lines after the first line if there was no leading newline,
+  // to ensure consistent behavior regardless of first line content.
   size_t ws = lexer->buflen;
   size_t ws_this_line = 0;
   bool in_leading_ws = true;
   bool has_non_ws = false;
+  bool first_line = !had_leading_newline;
 
   for(size_t i = 0; i < lexer->buflen; i++)
   {
@@ -559,7 +565,9 @@
         if(!isspace(c))
           has_non_ws = true;
 
-        if(has_non_ws && (ws_this_line < ws))
+        // Only count whitespace from lines after the first line if there was
+        // no leading newline, to get consistent behavior
+        if(has_non_ws && !first_line && (ws_this_line < ws))
           ws = ws_this_line;
 
         in_leading_ws = false;
@@ -571,15 +579,17 @@
       ws_this_line = 0;
       has_non_ws = false;
       in_leading_ws = true;
+      first_line = false;
     }
   }
 
   // Trim leading whitespace on each line.
-  if(ws > 0)
+  if(ws > 0 && ws < lexer->buflen)
   {
     char* line_start = lexer->buffer;
     char* compacted = lexer->buffer;
     size_t rem = lexer->buflen;
+    bool is_first_line = !had_leading_newline;
 
     while(rem > 0)
     {
@@ -587,7 +597,13 @@
       size_t line_len =
         (line_end == NULL) ? rem : (size_t)(line_end - line_start + 1);
 
-      if(line_start != line_end)
+      // Don't trim the first line if there was no leading newline
+      if(is_first_line)
+      {
+        memmove(compacted, line_start, line_len);
+        compacted += line_len;
+      }
+      else if(line_start != line_end)
       {
         size_t trim = (line_len < ws) ? line_len : ws;
         memmove(compacted, line_start + trim, line_len - trim);
@@ -601,6 +617,7 @@
 
       line_start += line_len;
       rem -= line_len;
+      is_first_line = false;
     }
 
     lexer->buflen = compacted - lexer->buffer;
