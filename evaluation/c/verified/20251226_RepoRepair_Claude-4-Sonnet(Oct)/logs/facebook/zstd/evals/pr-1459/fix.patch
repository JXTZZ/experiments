--- a/programs/fileio.c
+++ b/programs/fileio.c
@@ -1112,6 +1112,22 @@
     assert(ress.srcFile != NULL);
 
     if (ress.dstFile == NULL) {
+        /* Check if source and destination are the same file */
+        if (strcmp(srcFileName, stdinmark) && strcmp(dstFileName, stdoutmark)) {
+            stat_t srcStatbuf, dstStatbuf;
+            if (UTIL_getFileStat(srcFileName, &srcStatbuf) && UTIL_getFileStat(dstFileName, &dstStatbuf)) {
+                /* Both files exist, check if they're the same */
+#if defined(_MSC_VER)
+                if (srcStatbuf.st_dev == dstStatbuf.st_dev && srcStatbuf.st_ino == dstStatbuf.st_ino) {
+#else
+                if (srcStatbuf.st_dev == dstStatbuf.st_dev && srcStatbuf.st_ino == dstStatbuf.st_ino) {
+#endif
+                    DISPLAYLEVEL(1, "zstd: %s: cannot write to same file as input \n", dstFileName);
+                    return 1;
+                }
+            }
+        }
+        
         closeDstFile = 1;
         DISPLAYLEVEL(6, "FIO_compressFilename_dstFile: opening dst: %s", dstFileName);
         ress.dstFile = FIO_openDstFile(dstFileName);
