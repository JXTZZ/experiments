--- a/programs/fileio.c
+++ b/programs/fileio.c
@@ -962,7 +962,19 @@
     CHECK( ZSTD_CCtx_setParameter(ress.cctx, ZSTD_c_useRowMatchFinder, prefs->useRowMatchFinder));
     /* compression parameters */
     CHECK( ZSTD_CCtx_setParameter(ress.cctx, ZSTD_c_windowLog, (int)comprParams.windowLog) );
+    /* Cap chainLog to avoid undefined behavior (shift larger than type width) */
+    if (comprParams.chainLog > 24) {
+        DISPLAYLEVEL(2, "NOTE: chainLog capped at 24 (from %u) to avoid potential undefined behavior\n", comprParams.chainLog);
+        comprParams.chainLog = 24;
+    }
     CHECK( ZSTD_CCtx_setParameter(ress.cctx, ZSTD_c_chainLog, (int)comprParams.chainLog) );
+    /* Cap hashLog: 24 bits normally, 28 bits (24+4) for row match finder */
+    {   unsigned const maxHashLog = prefs->useRowMatchFinder ? 28 : 24;
+        if (comprParams.hashLog > maxHashLog) {
+            DISPLAYLEVEL(2, "NOTE: hashLog capped at %u (from %u) to avoid potential undefined behavior\n", maxHashLog, comprParams.hashLog);
+            comprParams.hashLog = maxHashLog;
+        }
+    }
     CHECK( ZSTD_CCtx_setParameter(ress.cctx, ZSTD_c_hashLog, (int)comprParams.hashLog) );
     CHECK( ZSTD_CCtx_setParameter(ress.cctx, ZSTD_c_searchLog, (int)comprParams.searchLog) );
     CHECK( ZSTD_CCtx_setParameter(ress.cctx, ZSTD_c_minMatch, (int)comprParams.minMatch) );

--- a/programs/zstdcli.c
+++ b/programs/zstdcli.c
@@ -1539,6 +1539,21 @@
         if (adaptMin > cLevel) cLevel = adaptMin;
         if (adaptMax < cLevel) cLevel = adaptMax;
 
+        /* Validate hashLog and chainLog to prevent undefined behavior */
+        if (compressionParams.chainLog > 24) {
+            DISPLAYLEVEL(2, "Warning : chainLog capped at 24 (was %u) \n", compressionParams.chainLog);
+            compressionParams.chainLog = 24;
+        }
+        /* For row-based matchfinder, hashLog must be <= 28 (24 + 4) */
+        if (useRowMatchFinder && compressionParams.hashLog > 28) {
+            DISPLAYLEVEL(2, "Warning : hashLog capped at 28 for row-based matchfinder (was %u) \n", compressionParams.hashLog);
+            compressionParams.hashLog = 28;
+        } else if (compressionParams.hashLog > 24) {
+            /* For non-row matchfinder, cap at 24 */
+            DISPLAYLEVEL(2, "Warning : hashLog capped at 24 (was %u) \n", compressionParams.hashLog);
+            compressionParams.hashLog = 24;
+        }
+
         /* Compare strategies constant with the ground truth */
         { ZSTD_bounds strategyBounds = ZSTD_cParam_getBounds(ZSTD_c_strategy);
           assert(ZSTD_NB_STRATEGIES == strategyBounds.upperBound);
