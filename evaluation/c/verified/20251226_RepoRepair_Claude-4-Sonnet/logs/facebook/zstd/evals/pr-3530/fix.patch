--- a/lib/compress/zstd_compress.c
+++ b/lib/compress/zstd_compress.c
@@ -1191,6 +1191,44 @@
     return 0;
 }
 
+size_t ZSTD_CCtx_setFParams(ZSTD_CCtx* cctx, ZSTD_frameParameters fparams)
+{
+    DEBUGLOG(4, "ZSTD_CCtx_setFParams");
+    RETURN_ERROR_IF(cctx->streamStage != zcss_init, stage_wrong,
+                    "Can't set fParams when not in init stage.");
+    cctx->requestedParams.fParams = fparams;
+    return 0;
+}
+
+size_t ZSTD_CCtx_setParameters(ZSTD_CCtx* cctx, ZSTD_parameters params)
+{
+    DEBUGLOG(4, "ZSTD_CCtx_setParameters");
+    RETURN_ERROR_IF(cctx->streamStage != zcss_init, stage_wrong,
+                    "Can't set parameters when not in init stage.");
+    FORWARD_IF_ERROR(ZSTD_checkCParams(params.cParams), "");
+    cctx->requestedParams.cParams = params.cParams;
+    cctx->requestedParams.fParams = params.fParams;
+    return 0;
+}
+
+size_t ZSTD_CCtxParams_setFParams(ZSTD_CCtx_params* cctxParams, ZSTD_frameParameters fparams)
+{
+    DEBUGLOG(4, "ZSTD_CCtxParams_setFParams");
+    RETURN_ERROR_IF(!cctxParams, GENERIC, "NULL pointer!");
+    cctxParams->fParams = fparams;
+    return 0;
+}
+
+size_t ZSTD_CCtxParams_setParameters(ZSTD_CCtx_params* cctxParams, ZSTD_parameters params)
+{
+    DEBUGLOG(4, "ZSTD_CCtxParams_setParameters");
+    RETURN_ERROR_IF(!cctxParams, GENERIC, "NULL pointer!");
+    FORWARD_IF_ERROR(ZSTD_checkCParams(params.cParams), "");
+    cctxParams->cParams = params.cParams;
+    cctxParams->fParams = params.fParams;
+    return 0;
+}
+
 size_t ZSTD_CCtx_setPledgedSrcSize(ZSTD_CCtx* cctx, unsigned long long pledgedSrcSize)
 {
     DEBUGLOG(4, "ZSTD_CCtx_setPledgedSrcSize to %llu bytes", pledgedSrcSize);

--- a/programs/zstdcli.c
+++ b/programs/zstdcli.c
@@ -1575,6 +1575,19 @@
             }
         }
 
+        /* Normalize compression parameters: replace 0 values with defaults */
+        {   unsigned long long const fileSize = (filenames->tableSize > 0) ? UTIL_getFileSize(filenames->fileNames[0]) : UTIL_FILESIZE_UNKNOWN;
+            const size_t dictSize = dictFileName != NULL ? (size_t)UTIL_getFileSize(dictFileName) : 0;
+            ZSTD_compressionParameters defaultParams = ZSTD_getCParams(cLevel, fileSize, dictSize);
+            if (compressionParams.windowLog == 0) compressionParams.windowLog = defaultParams.windowLog;
+            if (compressionParams.chainLog == 0) compressionParams.chainLog = defaultParams.chainLog;
+            if (compressionParams.hashLog == 0) compressionParams.hashLog = defaultParams.hashLog;
+            if (compressionParams.searchLog == 0) compressionParams.searchLog = defaultParams.searchLog;
+            if (compressionParams.minMatch == 0) compressionParams.minMatch = defaultParams.minMatch;
+            if (compressionParams.targetLength == 0) compressionParams.targetLength = defaultParams.targetLength;
+            if (compressionParams.strategy == 0) compressionParams.strategy = defaultParams.strategy;
+        }
+
         if (g_displayLevel >= 4)
             FIO_displayCompressionParameters(prefs);
         if ((filenames->tableSize==1) && outFileName)
