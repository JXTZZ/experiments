--- a/src/locfile.c
+++ b/src/locfile.c
@@ -32,7 +32,7 @@
 int locfile_get_line(struct locfile* l, int pos) {
   assert(pos < l->length);
   int line = 1;
-  while (l->linemap[line] <= pos) line++;
+  while (line <= l->nlines && l->linemap[line] <= pos) line++;
   assert(line-1 < l->nlines);
   return line-1;
 }