{"instance_id": "facebook__zstd-1837", "rag_files": [{"filename": "1837.txt", "content": "repo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD.nextInputType.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD.findFrameCompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_ZSTD.nextInputType.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_internal.h_ZSTD.frameIdSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_linux_zstd.h_ZSTD.getFrameContentSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_estimateDStreamSize.fromFrame.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_ZSTD.findDecompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD_decompressBlock.internal.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_ZSTD.frameHeaderSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_seekable.h_ZSTD_seekable.offsetToFrameIndex.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v07.c_HUFv07_decompress1X.DCtx.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v07.c_ZSTD.errorFrameSizeInfoLegacy.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.c_ZSTDv06.getFrameParams.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v07.c_ZSTDv07_frameHeaderSize.min.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v07.c_ZSTDv07.skippableHeaderSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v02.c_ZSTDv02.findFrameCompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.c_ZSTDv06.decompressContinue.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_ZSTD_decompress.usingDDict.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD_getFrameHeader.advanced.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v07.c_ZSTDv07.isSkipFrame.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD_getFrameHeader.internal.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v01.h_ZSTDv01.nextSrcSizeToDecompress.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD.decompressMultiFrame.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_ZSTD.getFrameParams.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD.decompressContinue.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD_initDStream.usingDict.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD_DCtx.setFormat.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_internal.h_ZSTD.blockHeaderSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_skippableHeaderSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v05.c_ZSTDv05.sizeofDCtx.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v01.c_ZSTDv01.resetDCtx.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompressFrames.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD.getFrameHeader.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.c_ZBUFFv06_DCtx.s.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_ZSTD.decompressBegin.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_ZSTD.isSkipFrame.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.c_ZSTDv06_frameHeaderSize.min.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress_test.c_zstd_decompress_test.open.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstdseek_compress.c_anonymous.struct.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v05.c_ZSTDv05.getFrameParams.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.c_ZSTDv06.decodeFrameHeader.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v02.h_ZSTDv02.findFrameSizeInfoLegacy.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_legacy.h_ZSTD.findFrameCompressedSizeLegacy.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_linux_zstd.h_ZSTD.findDecompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_frameHeaderSize.prefix.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_frameHeaderSize.max.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v04.c_ZSTD_decodeFrameHeader.Part2.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c.readSkippableFrameSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v02.h_ZSTDv02.findFrameCompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.h_ZSTDv06.getFrameParams.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.c_ZSTDv06.findFrameCompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v07.h_ZSTDv07.findFrameSizeInfoLegacy.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v05.c_ZSTDv05_decompress.continueDCtx.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_zstd_internal.h_ZSTD_fcs_fieldSize.4.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v05.c_ZSTDv05.decompressBegin.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_compress.c_ZSTD.writeFrameHeader.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD.errorFrameSizeInfo.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_internal.h_ZSTD_fcs_fieldSize.4.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_DStream.s.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_getDecompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_frameHeaderSize.min.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.c_ZSTDv06.decompressFrame.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_function.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_decode_data.frame.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_frameHeaderSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v02.c_ZSTD.frameHeaderSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_linux_zstd.h_ZSTD_frameHeaderSize.max.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.c_ZSTDv06.frameHeaderSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_getFrameHeader.advanced.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.h_ZSTD_get_decompressed.size.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.c_ZSTDv06_DCtx.s.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_ZSTD.getFrameContentSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompressBlock.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v04.c_ZSTD.resetDCtx.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_ZSTD.decodeFrameHeader.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v05.h_ZSTDv05.getFrameParams.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_linux_zstd.h_ZSTD.skippableHeaderSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v02.c_ZSTD.findFrameCompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompressZstdFrame.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v05.c_ZSTDv05_decodeFrameHeader.Part2.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v07.c_ZSTDv07_fcs_fieldSize.4.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v07.c_ZSTDv07.frameHeaderSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v05.c_ZSTDv05_decodeFrameHeader.Part1.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v01.h_ZSTDv01.findFrameCompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_ZSTD.findFrameCompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v07.c_ZSTDv07.decompressBegin.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_findFrameCompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD.findFrameSizeInfo.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.c_ZSTDv06_fcs_fieldSize.4.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v03.h_ZSTDv03.findFrameSizeInfoLegacy.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD_frameHeaderSize.internal.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_decompress.data.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v07.c_ZSTDv07.getDecompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.h_ZSTDv06.findFrameSizeInfoLegacy.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.h_ZSTDv06_frameParams.s.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v01.c_ZSTD.frameHeaderSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_legacy.h_ZSTD_getDecompressedSize.legacy.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v03.c_ZSTD.errorFrameSizeInfoLegacy.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v02.c_ZSTDv02.findFrameSizeInfoLegacy.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v04.c_ZSTD.getFrameParams.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD.decodeFrameHeader.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD.frameHeaderSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v04.c_ZSTDv04.getFrameParams.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD_estimateDStreamSize.fromFrame.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v04.c_ZSTD_frameHeaderSize.min.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD.getFrameContentSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_linux_zstd.h_ZSTD_frameHeaderSize.prefix.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v03.h_ZSTDv03.findFrameCompressedSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v05.c_ZSTDv05_frameHeaderSize.min.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v03.c_ZSTD.frameHeaderSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD.isSkipFrame.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v04.c_ZSTD_decodeFrameHeader.Part1.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_zstd_decompress.c_ZSTD.resetDStream.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_getFrameContentSize.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v07.c_ZSTDv07.decodeFrameHeader.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_decompress.c_ZSTD.decompressBegin.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.c_ZSTDv06.findFrameSizeInfoLegacy.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v07.c_ZSTDv07_frameHeaderSize.max.txt\nrepo_document_file\\c\\facebook\\zstd\\1837\\c_facebook_zstd_1837_v06.h_ZSTDv06.nextSrcSizeToDecompress.txt"}], "buggy_files": [{"filename": "1837.txt", "content": "Let me analyze this step by step.\n\n## 1. Identify the wrong behavior\n\nThe problem describes that `ZSTD_frameHeaderSize` calculation ignores the context's format and results in the wrong size. The issue is at line 636 in `lib/decompress/zstd_decompress.c` where `ZSTD_frameHeaderSize` should be replaced with `ZSTD_frameHeaderSize_internal` and should pass the `dctx->format` parameter.\n\n## 2. Analyze the cause behind the wrong behavior\n\nThe cause is that the current code uses `ZSTD_frameHeaderSize` which doesn't take the decompression context's format into account. This leads to incorrect frame header size calculations. The fix requires:\n- Replacing `ZSTD_frameHeaderSize` with `ZSTD_frameHeaderSize_internal`\n- Passing the `dctx->format` parameter to account for the specific format being used\n\n## 3. Find the most related files\n\nBased on the problem description and the repository structure, the files most related to this issue are:\n\n```\nlib/decompress/zstd/decompress.c\nlib/decompress/zstd/decompress/internal.h\nlib/common/zstd/internal.h\nlib/zstd.h\n```\n\nThe primary file that needs editing is `lib/decompress/zstd/decompress.c` (which corresponds to the GitHub link `lib/decompress/zstd_decompress.c`), followed by the internal header files that likely contain the function declarations and definitions for `ZSTD_frameHeaderSize_internal`."}], "repair_results": [{"filename": "lib_common_zstd_internal.h.txt", "content": "Looking at the issue, I need to:\n\n1. Find the code at line 636 in `lib/decompress/zstd_decompress.c` that calls `ZSTD_frameHeaderSize`\n2. Change it to use `ZSTD_frameHeaderSize_internal` and pass the `dctx->format` parameter\n\nHowever, I notice that the code segments provided only show `lib_common_zstd_internal.h`, not the actual file mentioned in the issue (`lib/decompress/zstd_decompress.c`). \n\nBased on the issue description, the problem is that `ZSTD_frameHeaderSize` doesn't take the context's format into account, and we need to use `ZSTD_frameHeaderSize_internal` instead, passing `dctx->format` as a parameter.\n\nSince I don't have the actual source file shown, I'll need to make an educated guess about what the code looks like at line 636. The typical pattern would be something like:\n\n```c\nframeHeaderSize = ZSTD_frameHeaderSize(src, srcSize);\n```\n\nAnd it should be changed to:\n\n```c\nframeHeaderSize = ZSTD_frameHeaderSize_internal(src, srcSize, dctx->format);\n```\n\nHowever, without seeing the actual file content, I cannot provide the exact SEARCH/REPLACE block. Let me provide what the fix would likely look like:\n\n```c\n### lib/decompress/zstd_decompress.c\n<<<<<<< SEARCH\n        size_t const frameHeaderSize = ZSTD_frameHeaderSize(src, srcSize);\n=======\n        size_t const frameHeaderSize = ZSTD_frameHeaderSize_internal(src, srcSize, dctx->format);\n>>>>>>> REPLACE\n```\n\nIf the code doesn't have the `const` keyword or has different variable naming, the pattern would be similar but adjusted. For example, it might be:\n\n```c\n### lib/decompress/zstd_decompress.c\n<<<<<<< SEARCH\n        frameHeaderSize = ZSTD_frameHeaderSize(src, srcSize);\n=======\n        frameHeaderSize = ZSTD_frameHeaderSize_internal(src, srcSize, dctx->format);\n>>>>>>> REPLACE\n```\n\nWithout the actual file content being provided in the code segments, I cannot give the exact SEARCH/REPLACE block with proper context and indentation. Could you please provide the content of `lib/decompress/zstd_decompress.c` around line 636?"}, {"filename": "lib_decompress_zstd_decompress.c.txt", "content": "Looking at the issue, I need to find where `ZSTD_frameHeaderSize` is called and should be replaced with `ZSTD_frameHeaderSize_internal` to pass the `dctx->format` parameter.\n\nLet me search for the problematic line mentioned in the issue (around line 636). Looking at the code, I can see in the `ZSTD_decompressFrame` function:\n\n```c\n/* Frame Header */\n{   size_t const frameHeaderSize = ZSTD_frameHeaderSize(ip, ZSTD_FRAMEHEADERSIZE_PREFIX);\n```\n\nThis is the bug! The function `ZSTD_frameHeaderSize` always uses `ZSTD_f_zstd1` format (as we can see from its implementation), but it should respect the `dctx->format` parameter. The fix is to use `ZSTD_frameHeaderSize_internal` instead and pass `dctx->format`.\n\nHere's the fix:\n\n```c\n###lib_decompress_zstd_decompress.c\n<<<<<<< SEARCH\n    /* Frame Header */\n    {   size_t const frameHeaderSize = ZSTD_frameHeaderSize(ip, ZSTD_FRAMEHEADERSIZE_PREFIX);\n        if (ZSTD_isError(frameHeaderSize)) return frameHeaderSize;\n        RETURN_ERROR_IF(remainingSrcSize < frameHeaderSize+ZSTD_blockHeaderSize,\n                        srcSize_wrong);\n        FORWARD_IF_ERROR( ZSTD_decodeFrameHeader(dctx, ip, frameHeaderSize) );\n        ip += frameHeaderSize; remainingSrcSize -= frameHeaderSize;\n    }\n=======\n    /* Frame Header */\n    {   size_t const frameHeaderSize = ZSTD_frameHeaderSize_internal(ip, ZSTD_FRAMEHEADERSIZE_PREFIX, dctx->format);\n        if (ZSTD_isError(frameHeaderSize)) return frameHeaderSize;\n        RETURN_ERROR_IF(remainingSrcSize < frameHeaderSize+ZSTD_blockHeaderSize,\n                        srcSize_wrong);\n        FORWARD_IF_ERROR( ZSTD_decodeFrameHeader(dctx, ip, frameHeaderSize) );\n        ip += frameHeaderSize; remainingSrcSize -= frameHeaderSize;\n    }\n>>>>>>> REPLACE\n```"}, {"filename": "lib_zstd.h.txt", "content": "Looking at the issue, I need to find the code at line 636 in `lib/decompress/zstd_decompress.c` that calls `ZSTD_frameHeaderSize`. The issue states that this call ignores the context's format and should instead use `ZSTD_frameHeaderSize_internal` with the `dctx->format` parameter.\n\nHowever, the provided code is from `lib_zstd.h`, which is a header file, not the decompression source file. Let me search for the relevant code pattern that would be calling `ZSTD_frameHeaderSize`.\n\nBased on the issue description, I need to:\n1. Find where `ZSTD_frameHeaderSize` is being called\n2. Replace it with `ZSTD_frameHeaderSize_internal` \n3. Pass the `dctx->format` parameter\n\nSince the actual source file isn't provided, but I can see from the header that `ZSTD_frameHeaderSize` is declared as:\n```c\nZSTDLIB_API size_t ZSTD_frameHeaderSize(const void* src, size_t srcSize);\n```\n\nAnd there's likely an internal version `ZSTD_frameHeaderSize_internal` that takes a format parameter.\n\nLooking at the header file, I can see there's a `ZSTD_format_e` enum and `ZSTD_getFrameHeader_advanced` which takes a format parameter, suggesting there's an internal API that respects format.\n\nSince I don't have the actual `zstd_decompress.c` file in the provided code, I cannot make the exact edit. However, based on the issue description pointing to line 636 of that file, the fix would look something like this:\n\n```c\n### lib/decompress/zstd_decompress.c\n<<<<<<< SEARCH\n    frameHeaderSize = ZSTD_frameHeaderSize(src, srcSize);\n=======\n    frameHeaderSize = ZSTD_frameHeaderSize_internal(src, srcSize, dctx->format);\n>>>>>>> REPLACE\n```\n\nHowever, since the actual file content isn't provided in the code segments, I cannot provide the exact SEARCH/REPLACE block with the correct surrounding context. The issue clearly states the location (line 636) and what needs to be changed (use `ZSTD_frameHeaderSize_internal` with `dctx->format` parameter instead of `ZSTD_frameHeaderSize`), but without seeing the actual source code at that location, I cannot provide a precise edit with proper context."}]}
